#include "driver-test.h"
#include "cdev_sgdma.h"

#define DEFAULT_BUFFER_SIZE 128

/* Meta Information */
MODULE_LICENSE("GPL");
MODULE_AUTHOR("Lukas Fuereder");
MODULE_DESCRIPTION("Generic Test Driver, if probed accesses the gpio_driver and modifies its current entry.");

const char src_buffer[DEFAULT_BUFFER_SIZE] = {
	0xDE, 0xAD, 0xBE, 0xEF, 0x00, 0x11, 0x22, 0x33, 0xDE, 0xAD, 0xBE,
	0xEF, 0x00, 0x44, 0x55, 0x66, 0xDE, 0xAD, 0xBE, 0xEF, 0x00, 0x77,
	0x88, 0x99, 0xDE, 0xAD, 0xBE, 0xEF, 0x00, 0xAA, 0xBB, 0xCC,

	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x11, 0x11, 0x11,
	0x11, 0x11, 0x11, 0x11, 0x12, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
	0x22, 0x23, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x34,

	0xBA, 0xD0, 0xC0, 0xDE, 0x00, 0x11, 0x22, 0x33, 0xBA, 0xD0, 0xC0,
	0xDE, 0x00, 0x44, 0x55, 0x66, 0xBA, 0xD0, 0xC0, 0xDE, 0x00, 0x77,
	0x88, 0x99, 0xBA, 0xD0, 0xC0, 0xDE, 0x00, 0xAA, 0xBB, 0xCC,
};

/**
 * @brief This function is called, when the module is loaded into the kernel
 */
static int __init my_init(void)
{	
	printk("file_access - Loading driver\n");

	/* writing data to the FPGA */
	egress_thread_add_work(&src_buffer[0], DEFAULT_BUFFER_SIZE);
	printk("[ INFO ] egress thread add sucessfull\n");
	return 0;
}

/**
 * @brief This function is called, when the module is removed from the kernel
 */
static void __exit my_exit(void)
{
	printk("file_access - Unloading driver\n");
}

module_init(my_init);
module_exit(my_exit);
